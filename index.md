---
layout: default
---

**æ¬¢è¿æ¥åˆ°ä¹¦ç±ã€Š.NET Core åº•å±‚å…¥é—¨ã€‹çš„æ”¯æŒç«™ç‚¹ï¼**

**æœ¬ä¹¦ä¸»è¦ä»‹ç» .NET Core å…¬å…±è¯­è¨€è¿è¡Œæ—¶çš„åº•å±‚å®ç°ï¼ŒåŒ…æ‹¬å¼‚å¸¸ã€å¤šçº¿ç¨‹ã€GC ä»¥åŠ JIT çš„å®ç°åŸç†ä¸å®ç°ç»†èŠ‚ã€‚é˜…è¯»æœ¬ä¹¦å¯ä»¥åŠ æ·±å¯¹ .NET æ¡†æ¶çš„ç†è§£ï¼Œè¿™äº›çŸ¥è¯†ä¼šåœ¨ç¼–å†™æ¡†æ¶ä»¥åŠé«˜æ€§èƒ½ç¨‹åºæ—¶å‘æŒ¥é‡è¦çš„ä½œç”¨ï¼Œå¦‚æœæ‚¨æœ‰å…´è¶£ï¼Œæœ¬ä¹¦ä¸­çš„çŸ¥è¯†è¿˜å¯ä»¥å¸®åŠ©æ‚¨å‘ CoreCLR æ·»åŠ æˆ–ä¿®æ”¹åŠŸèƒ½å¹¶è´¡çŒ®ä»£ç ï¼Œæˆ–è€…å®ç°ä¸€ä¸ªè‡ªå·±çš„è¯­è¨€æ¡†æ¶ã€‚**

**æœ¬ä¹¦ç”±è€å†œ(Github: [303248153](https://github.com/303248153)) ä¸åˆ˜æµ©æ¨ (Github: [LiuHaoYang](https://github.com/LiuHaoYang)) ç¼–å†™ã€‚è€å†œæ›¾æ·±å…¥é˜…è¯»è¿‡ CoreCLR çš„æºä»£ç ï¼Œåœ¨åšå®¢å›­ä¸Šå‘è¡¨è¿‡[ç³»åˆ—æ–‡ç« ](https://www.cnblogs.com/zkweb/category/935426.html)ï¼Œå¹¶ç¼–å†™è¿‡ .NET çš„ Web æ¡†æ¶ [ZKWeb](https://github.com/zkweb-framework/ZKWeb) ä¸ C++ çš„ Cassandra é©±åŠ¨ [cpv-cql-driver](https://github.com/cpv-project/cpv-cql-driver)ã€‚åˆ˜æµ©æ¨æ˜¯ .NET çš„ AOP æ¡†æ¶ [AspectCore](https://github.com/dotnetcore/AspectCore-Framework) çš„ä½œè€…ï¼Œä¸ºè‘—åçš„ APM æ¡†æ¶ [Apache SkyWalking](https://github.com/apache/incubator-skywalking) æä¾›äº† .NET æ”¯æŒï¼Œå¹¶åœ¨ 2018 å¹´è·å¾—å¾®è½¯çš„ MVP å¤´è¡”ã€‚**

# ç« èŠ‚åˆ—è¡¨

æœ¬ä¹¦ä¸€å…± 524 é¡µï¼Œåˆ†ä¸º 8 ç« ï¼Œå…¶ä¸­å‰ 4 ç« æ˜¯ç†è§£ .NET Core åº•å±‚å®ç°æ‰€éœ€è¦çš„åŸºç¡€çŸ¥è¯†ï¼Œå 4 ç« æ˜¯ .NET Core åº•å±‚å®ç°çš„å…·ä½“ä»‹ç»ã€‚

ä»¥ä¸‹æ˜¯æœ¬ä¹¦çš„ç›®å½•ï¼Œå…¶ä¸­ç¬¬ä¸€ç« ã€ç¬¬ä¸ƒç« å‰ä¸¤èŠ‚ä¸ç¬¬å…«ç« å‰ä¸¤èŠ‚æä¾›è¯•è¯»ï¼Œè¯·ç‚¹å‡»å¯¹åº”ç« èŠ‚åçš„é“¾æ¥æŸ¥çœ‹è¯•è¯»å†…å®¹ã€‚

## ç¬¬ä¸€ç«  - å…¬å…±è¯­è¨€è¿è¡Œæ—¶æ¦‚è¿°

- 1.1 - å…¬å…±è¯­è¨€è¿è¡Œæ—¶æ¦‚è¿° (è¯•è¯»: [1](./assets/img/1-1.jpg) [2](./assets/img/1-2.jpg) [3](./assets/img/1-3.jpg) [4](./assets/img/1-4.jpg) [5](./assets/img/1-5.jpg) [6](./assets/img/1-6.jpg))

## ç¬¬äºŒç«  - MSIL å…¥é—¨

- 2.1 - é€†å‘ .NET ç¨‹åºåˆ° IL
- 2.2 - åŸºç¡€è¯­æ³•
- 2.3 - æµç¨‹æ§åˆ¶

## ç¬¬ä¸‰ç«  - x86 æ±‡ç¼–å…¥é—¨

- 3.1 - æ±‡ç¼–ä¸æœºå™¨ç 
- 3.2 - å†…å­˜
- 3.3 - å¯„å­˜å™¨
- 3.4 - åŸºç¡€æŒ‡ä»¤
- 3.5 - æµç¨‹æ§åˆ¶
- 3.6 - å‡½æ•°è°ƒç”¨
- 3.7 - ç³»ç»Ÿè°ƒç”¨
- 3.8 - å†…å­˜å±éšœ

## ç¬¬å››ç«  - ç¼–è¯‘ä¸è°ƒè¯• CoreCLR

- 4.1 - åœ¨ Windows ä¸Šç¼–è¯‘ CoreCLR
- 4.2 - åœ¨ Windows ä¸Šè°ƒè¯• CoreCLR
- 4.3 - åœ¨ Linux ä¸Šç¼–è¯‘ CoreCLR
- 4.4 - åœ¨ Linux ä¸Šè°ƒè¯• CoreCLR

## ç¬¬äº”ç«  - å¼‚å¸¸å¤„ç†å®ç°

- 5.1 - å¼‚å¸¸å¤„ç†ç®€ä»‹
- 5.2 - ç”¨æˆ·å¼‚å¸¸çš„è§¦å‘
- 5.3 - ç¡¬ä»¶å¼‚å¸¸çš„è§¦å‘
- 5.4 - å¼‚å¸¸å¤„ç†å®ç°
- 5.5 - å¼‚å¸¸å¤„ç†å¯¹æ€§èƒ½çš„å½±å“

## ç¬¬å…­ç«  - å¤šçº¿ç¨‹å®ç°

- 6.1 - åŸç”Ÿçº¿ç¨‹
- 6.2 - æ‰˜ç®¡çº¿ç¨‹
- 6.3 - æŠ¢å æ¨¡å¼ä¸åˆä½œæ¨¡å¼
- 6.4 - çº¿ç¨‹æœ¬åœ°å‚¨å­˜
- 6.5 - åŸå­æ“ä½œ
- 6.6 - è‡ªæ—‹é” (Spinlock)
- 6.7 - äº’æ–¥é” (Mutex)
- 6.8 - æ··åˆé” (Monitor) ä¸ lock è¯­å¥
- 6.9 - ä¿¡å·é‡ (Semaphore)
- 6.10 - è¯»å†™é” (ReaderWriterLock)
- 6.11 - å¼‚æ­¥æ“ä½œ
- 6.12 - æ‰§è¡Œä¸Šä¸‹æ–‡ (ExecutionContext)
- 6.13 - åŒæ­¥ä¸Šä¸‹æ–‡ (SynchronizationContext)

## ç¬¬ä¸ƒç«  - GC åƒåœ¾å›æ”¶å®ç°

- 7.1 - GC ç®€ä»‹ (è¯•è¯»: [1](./assets/img/7-1.jpg) [2](./assets/img/7-2.jpg) [3](./assets/img/7-3.jpg) [4](./assets/img/7-4.jpg) [5](./assets/img/7-5.jpg) [6](./assets/img/7-6.jpg) [7](./assets/img/7-7.jpg) [8](./assets/img/7-8.jpg) [9](./assets/img/7-9.jpg) [10](./assets/img/7-10.jpg) [11](./assets/img/7-11.jpg) [12](./assets/img/7-12.jpg))
- 7.2 - å¯¹è±¡å†…å­˜ç»“æ„ (è¯•è¯»: [12](./assets/img/7-12.jpg) [13](./assets/img/7-13.jpg) [14](./assets/img/7-14.jpg) [15](./assets/img/7-15.jpg) [16](./assets/img/7-16.jpg) [17](./assets/img/7-17.jpg) [18](./assets/img/7-18.jpg) [19](./assets/img/7-19.jpg) [20](./assets/img/7-20.jpg))
- 7.3 - æ‰˜ç®¡å †ç»“æ„
- 7.4 - åˆ†é…å¯¹è±¡æµç¨‹
- 7.5 - åƒåœ¾å›æ”¶æµç¨‹
- 7.6 - æ ‡è®°é˜¶æ®µ (Mark)
- 7.7 - è®¡åˆ’é˜¶æ®µ (Plan)
- 7.8 - é‡å®šä½é˜¶æ®µ (Relocate)
- 7.9 - å‹ç¼©é˜¶æ®µ (Compact)
- 7.10 - æ¸…æ‰«é˜¶æ®µ (Sweep)
- 7.11 - åå° GC
- 7.12 - è°ƒæ•´ GC è¡Œä¸º
- 7.13 - è·å– GC ä¿¡æ¯

## ç¬¬å…«ç«  - JIT ç¼–è¯‘å™¨å®ç°

- 8.1 - JIT ç®€ä»‹ (è¯•è¯»: [1](./assets/img/8-1.jpg) [2](./assets/img/8-2.jpg) [3](./assets/img/8-3.jpg) [4](./assets/img/8-4.jpg))
- 8.2 - JIT ç¼–è¯‘æµç¨‹ (è¯•è¯»: [5](./assets/img/8-5.jpg) [6](./assets/img/8-6.jpg) [7](./assets/img/8-7.jpg) [8](./assets/img/8-8.jpg) [9](./assets/img/8-9.jpg) [10](./assets/img/8-10.jpg) [11](./assets/img/8-11.jpg) [12](./assets/img/8-12.jpg) [13](./assets/img/8-13.jpg))
- 8.3 - IR ç»“æ„
- 8.4 - IL è§£æ (Importer)
- 8.5 - å‡½æ•°å†…è” (Inliner)
- 8.6 - IR å˜å½¢ (Morph)
- 8.7 - æµç¨‹å›¾åˆ†æ (Flowgraph Analysis)
- 8.8 - æœ¬åœ°å˜é‡æ’åº (LclVar Sorting)
- 8.9 - è¯„ä»·é¡ºåºå®šä¹‰ (Tree Ordering)
- 8.10 - å˜é‡ç‰ˆæœ¬æ ‡è®° (SSA & VN)
- 8.11 - å¾ªç¯ä¼˜åŒ– (Loop Optimization)
- 8.12 - èµ‹å€¼ä¼ æ’­ (Copy Propagation)
- 8.13 - å…¬å…±å­è¡¨è¾¾å¼æ¶ˆé™¤ (CSE)
- 8.14 - æ–­è¨€ä¼ æ’­ (Assertion Propagation)
- 8.15 - è¾¹ç•Œæ£€æŸ¥æ¶ˆé™¤ (Range Check Elimination)
- 8.16 - åˆç†åŒ– (Rationalization)
- 8.17 - ä½çº§åŒ– (Lowering)
- 8.18 - çº¿æ€§æ‰«æå¯„å­˜å™¨åˆ†é… (LSRA)
- 8.19 - æ±‡ç¼–æŒ‡ä»¤ç”Ÿæˆ (CodeGen)
- 8.20 - æœºå™¨ä»£ç ç”Ÿæˆ (Emiiter)
- 8.21 - å‡½æ•°å¤´ä¿¡æ¯
- 8.22 - AOT ç¼–è¯‘

## é™„å½•

- 1 - ä¸­è‹±æ–‡ä¸“ä¸šåè¯å¯¹ç…§è¡¨
- 2 - å¸¸ç”¨ IL æŒ‡ä»¤ä¸€è§ˆ
- 3 - å¸¸ç”¨æ±‡ç¼–æŒ‡ä»¤ä¸€è§ˆ
- 4 - SOS æ‰©å±•å‘½ä»¤ä¸€è§ˆ
- 5 - IR è¯­æ³•æ ‘èŠ‚ç‚¹ç±»å‹ä¸€è§ˆ
- 6 - å‚è€ƒèµ„æ–™ä¸€è§ˆ

# å¸¸è§ç–‘é—®

## é˜…è¯»æœ¬ä¹¦éœ€è¦æ‹¥æœ‰å“ªäº›åŸºç¡€çŸ¥è¯†ï¼Ÿ

è™½ç„¶æœ¬ä¹¦ä¸ .NET Core æºä»£ç çš„å…³è”æ¯”è¾ƒå¤§ï¼Œéƒ¨åˆ†ç« èŠ‚ä¹Ÿä¼šç»™å‡ºç›¸å…³çš„æºä»£ç é“¾æ¥ï¼Œä½†ç†è§£æœ¬ä¹¦çš„å†…å®¹ä¸éœ€è¦é˜…è¯»æºä»£ç ï¼Œæœ¬ä¹¦åŒ…å«äº†å¤§é‡çš„å›¾è¡¨ç”¨äºè§£é‡Šæ•°æ®ç»“æ„ä¸å¤„ç†æµç¨‹ï¼Œå¦‚æœæ‚¨æ˜¯ä¸€ä¸ªæ‹¥æœ‰ä¸€å¹´ä»¥ä¸Šç»éªŒçš„ .NET å¼€å‘è€…ï¼Œå¹¶ä¸”å¯¹ .NET è¿è¡Œæ—¶åº•å±‚å®ç°æœ‰ä¸€å®šçš„å…´è¶£ï¼Œé‚£ä¹ˆåº”è¯¥å¯ä»¥é¡ºåˆ©çš„é˜…è¯»æœ¬ä¹¦å¹¶ç†è§£å¤§éƒ¨åˆ†å†…å®¹ã€‚

# é¸£è°¢åˆ—è¡¨

æœ¬ä¹¦åœ¨ç¼–å†™è¿‡ç¨‹ä¸­å¾—åˆ°äº† .NET ç¤¾åŒºä¸­å¾ˆå¤šç½‘å‹çš„æ”¯æŒï¼ŒåŒ…æ‹¬å‚ä¸ç¨¿ä»¶å®¡æ ¸ã€æå‡ºå»ºè®®ä¸æä¾›ç«™ç‚¹åŸŸåç­‰ï¼Œä»¥ä¸‹æ˜¯å‚ä¸çš„ç½‘å‹ä¸€è§ˆï¼Œåœ¨æ­¤å¯¹ä½ ä»¬è¡¨ç¤ºçœŸå¿ƒçš„æ„Ÿè°¢ï¼

- åˆ˜æ€¡ (Github: [alexinea](https://github.com/alexinea))
- å´æœ‹é£ (Github: [Skysper](https://github.com/Skysper))
- å•æ¯… (Github: [walterlv](https://github.com/walterlv))
- æ—å¾·ç†™ (Github: [lindexi](https://github.com/lindexi))
- å¼ è¡¡æ°´ (Github: [jonechenug](https://github.com/jonechenug))
- é‚¹åµ© (Github: [zlzforever](https://github.com/zlzforever))
- æ–½ç¦¹è¯š (Github: [linkinshi](https://github.com/linkinshi))
- æ¨æ™“ä¸œ (Github: [yang-xiaodong](https://github.com/yang-xiaodong))
- å‘¨å¯æ˜ (Github: [yzqmars](https://github.com/yzqmars))
- tinydyw (Github: [tinydyw](https://github.com/tinydyw))
- Ivony (Github: [Ivony](https://github.com/Ivony))
- carterHe (Github: [carterHe](https://github.com/carterHe))
- å…¨é›¨ç§‹ (Github: [quan01994](https://github.com/quan01994))

# è´­ä¹°æ–¹æ³•

æœ¬ä¹¦ç”±åŒ—äº¬èˆªç©ºèˆªå¤©å¤§å­¦å‡ºç‰ˆç¤¾å‡ºç‰ˆã€‚

è´­ä¹°çº¸è´¨ä¹¦ç±è¯·è®¿é—®ï¼š[äº¬ä¸œ](https://item.jd.com/12796746.html)

æ„Ÿè°¢æ‚¨çš„æ”¯æŒï¼

# äº¤æµè®¨è®º

æ¬¢è¿åŠ å…¥ä»¥ä¸‹ QQ ç¾¤ç»„è®¨è®º .NET Core çš„åº•å±‚å®ç°åŸç†ã€åˆ†äº«é«˜æ€§èƒ½ç¨‹åºçš„å¼€å‘ç»éªŒã€æ¢è®¨åŸºç¡€è®¾æ–½çš„è®¾è®¡æ–¹å¼ç­‰ã€‚

.NET Core åº•å±‚å®ç°äº¤æµç¾¤ï¼š**522083886**

å¦‚æœæ‚¨å¯¹æœ¬ä¹¦çš„å†…å®¹æœ‰ç–‘é—®ï¼Œä¹Ÿå¯ä»¥åˆ° Github ä»“åº“ [netcoreimpl/questions](https://github.com/netcoreimpl/questions)<br/>
åˆ›å»º Issue æé—®ï¼Œä½†å›ç­”å¯èƒ½éœ€è¦å‡ å¤©æ—¶é—´ï¼Œæ¨èå…ˆåœ¨ QQ ç¾¤ä¸­æé—®ï¼Œå¦‚æœæ²¡æœ‰è§£å†³å†åˆ›å»º Issueã€‚

# å‹˜è¯¯åˆ—è¡¨

ä»¥ä¸‹æ˜¯ç›®å‰å‘ç°çš„é”™è¯¯åˆ—è¡¨ï¼Œæ„Ÿè°¢æŒ‡å‡ºçš„è¯»è€…ä»¬ğŸ™ã€‚

- [18é¡µ](./assets/fix/18-1.png): å›¾ 2.6 çš„ç¬¬ä¸‰è¡Œ `set local variable 0` åº”ä¸º `load local variable 0`
- [19é¡µ, 480é¡µ](./assets/fix/480-1.png): div çš„è§£é‡Šåº”ä¸º `ä»è¯„ä»·å †æ ˆå–å‡ºä¸¤ä¸ªå€¼ï¼Œè®¡ç®—å®ƒä»¬çš„ç›¸é™¤ç»“æœå¹¶å­˜å…¥è¯„ä»·å †æ ˆ`
- [41é¡µ](./assets/fix/41-1.png): `è®¾ç½®å¯„å­˜å™¨ r0 çš„å€¼ä¸º 2` åº”è¯¥æ”¹ä¸º `è®¾ç½®å¯„å­˜å™¨ r1 çš„å€¼ä¸º 2`
- 363é¡µ: `æœºå™¨ä»£ç ç”Ÿæˆ(Emiiter):æ ¹æ®æ±‡ç¼–æŒ‡ä»¤ç”Ÿæˆæœºå™¨ç ã€‚` çš„ `Emiiter` åº”ä¸º `Emitter` 
- [409é¡µ](./assets/fix/409-1.png): åŸºç¡€å— `BB05` ä¸­çš„ `LCL_VAR V02` åº”è¯¥ä¸º `LCL_VAR V01` 
